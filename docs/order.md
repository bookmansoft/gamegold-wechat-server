# 订单系统工作流程(微信支付部分)

## 相关库表

由 buylogs (EntityType.BuyLog) 承担持久化任务

## 基本流程

1. 客户端购买VIP服务，或者购买众筹份额时，首先向服务端发起请求，服务端向微信发起预支付请求，如成功就将应答返回给客户端
2. 客户端发起微信支付，如果成功就会将结果提交给服务端，服务端收到后创建订单，将订单状态修订为"已支付-客户端"
3. 服务端收到微信回调，通知订单状态，服务端相应将订单状态修改为"已确认"或"已取消"，如果是"已确认"，服务端着手兑付订单内容
4. 服务端定期对订单进行状态检测，对超过一定时间、状态仍旧为"已支付-客户端"的订单，发起主动查询，并相应修改订单状态
