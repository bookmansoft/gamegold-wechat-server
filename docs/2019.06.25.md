# 游戏和主链对接

## 基本流程描述

1. 用户通过钱包系统登录，记录 openid/openkey/token
2. 用户点击游戏，跳转至游戏客户端，同时送出钱包证书，包括 openid/openkey/token 信息
3. 游戏客户端将钱包证书送至游戏服务端，游戏服务端验证后允许用户登录
4. 游戏服务端检索已登录用户的钱包余额，显示为用户钻石余额
5. 用户申请购买钻石，将跳转至钱包，完成购买流程后，再跳转回游戏，此时用户发现余额发生了变化
6. 用户使用钻石余额购买道具时，游戏客户端发起订单支付请求至钱包
7. 钱包完成支付流程，跳转回游戏客户端，此时用户发现余额发生了变化
8. 游戏服务端监控到订单完成消息，发放道具，并通知游戏客户端

## 钱包用户认证流程

1. 访问 h5.gamegold.xin 时，如果没有携带 code 参数，将自动调用 wxcode 拉起微信授权界面
2. 微信授权成功后，将跳回钱包首页(回跳地址是否可以提前设定？否则会丢失调用参数)
3. 可以直接持 openid/openkey 或者 token 登录，不必每次都到微信校验
